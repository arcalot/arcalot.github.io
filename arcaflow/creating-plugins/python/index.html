
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://arcalot.io/arcaflow/creating-plugins/python/">
      
      
        <link rel="prev" href="../../concepts/plugin-protocol/">
      
      
      <link rel="icon" href="../../../arcalot.svg">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.0">
    
    
      
        <title>Python - Arcalot</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.402914a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
    
    
      <link rel="stylesheet" href="../../../extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creating-plugins-with-python" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Arcalot" class="md-header__button md-logo" aria-label="Arcalot" data-md-component="logo">
      
  <img src="../../../arcalot.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Arcalot
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/arcalot/arcalot.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    arcalot/arcalot.github.io
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../arcalog/" class="md-tabs__link">
      Arcalog
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link md-tabs__link--active">
        Arcaflow
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Arcalot" class="md-nav__button md-logo" aria-label="Arcalot" data-md-component="logo">
      
  <img src="../../../arcalot.svg" alt="logo">

    </a>
    Arcalot
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/arcalot/arcalot.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    arcalot/arcalot.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../arcalog/" class="md-nav__link">
        Arcalog
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">Arcaflow</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Arcaflow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/workflows/" class="md-nav__link">
        Workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/typing/" class="md-nav__link">
        The typing system
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/plugin-protocol/" class="md-nav__link">
        The plugin protocol
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Creating plugins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Creating plugins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Python
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up-your-environment" class="md-nav__link">
    Setting up your environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-your-plugin-the-easy-way" class="md-nav__link">
    Creating your plugin the easy way
  </a>
  
    <nav class="md-nav" aria-label="Creating your plugin the easy way">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-parameters" class="md-nav__link">
    Input parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-parameters" class="md-nav__link">
    Output parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-step-function" class="md-nav__link">
    Creating a step function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-plugin" class="md-nav__link">
    Running the plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#types" class="md-nav__link">
    Types
  </a>
  
    <nav class="md-nav" aria-label="Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-parameters" class="md-nav__link">
    Optional parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-types" class="md-nav__link">
    Union types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata" class="md-nav__link">
    Metadata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-values" class="md-nav__link">
    Default values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#units" class="md-nav__link">
    Units
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-your-plugin-the-hard-way-not-recommended" class="md-nav__link">
    Creating your plugin the hard way (not recommended)
  </a>
  
    <nav class="md-nav" aria-label="Creating your plugin the hard way (not recommended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objecttype" class="md-nav__link">
    ObjectType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scopetype-and-reftype" class="md-nav__link">
    ScopeType and RefType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oneoftype" class="md-nav__link">
    OneOfType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stringtype" class="md-nav__link">
    StringType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patterntype" class="md-nav__link">
    PatternType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inttype" class="md-nav__link">
    IntType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#floattype" class="md-nav__link">
    FloatType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#booltype" class="md-nav__link">
    BoolType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumtype" class="md-nav__link">
    EnumType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listtype" class="md-nav__link">
    ListType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maptype" class="md-nav__link">
    MapType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-plugin_1" class="md-nav__link">
    Running the plugin
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-plugin" class="md-nav__link">
    Testing your plugin
  </a>
  
    <nav class="md-nav" aria-label="Testing your plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-a-serialization-test" class="md-nav__link">
    Writing a serialization test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functional-tests" class="md-nav__link">
    Functional tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedding-your-plugin" class="md-nav__link">
    Embedding your plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-can-i-add-a-field-with-dashes-such-as-my-field" class="md-nav__link">
    How can I add a field with dashes, such as my-field?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-write-a-dataclass-from-a-schema-to-a-yaml-or-json-file" class="md-nav__link">
    How can I write a dataclass from a schema to a YAML or JSON file?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-easily-load-a-list-from-a-yaml-or-json-into-a-list-of-dataclasses" class="md-nav__link">
    How can I easily load a list from a YAML or JSON into a list of dataclasses?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up-your-environment" class="md-nav__link">
    Setting up your environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-your-plugin-the-easy-way" class="md-nav__link">
    Creating your plugin the easy way
  </a>
  
    <nav class="md-nav" aria-label="Creating your plugin the easy way">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-parameters" class="md-nav__link">
    Input parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-parameters" class="md-nav__link">
    Output parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-step-function" class="md-nav__link">
    Creating a step function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-plugin" class="md-nav__link">
    Running the plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#types" class="md-nav__link">
    Types
  </a>
  
    <nav class="md-nav" aria-label="Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optional-parameters" class="md-nav__link">
    Optional parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union-types" class="md-nav__link">
    Union types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    Validation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata" class="md-nav__link">
    Metadata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-values" class="md-nav__link">
    Default values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#units" class="md-nav__link">
    Units
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-your-plugin-the-hard-way-not-recommended" class="md-nav__link">
    Creating your plugin the hard way (not recommended)
  </a>
  
    <nav class="md-nav" aria-label="Creating your plugin the hard way (not recommended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objecttype" class="md-nav__link">
    ObjectType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scopetype-and-reftype" class="md-nav__link">
    ScopeType and RefType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oneoftype" class="md-nav__link">
    OneOfType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stringtype" class="md-nav__link">
    StringType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patterntype" class="md-nav__link">
    PatternType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inttype" class="md-nav__link">
    IntType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#floattype" class="md-nav__link">
    FloatType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#booltype" class="md-nav__link">
    BoolType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumtype" class="md-nav__link">
    EnumType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listtype" class="md-nav__link">
    ListType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maptype" class="md-nav__link">
    MapType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-plugin_1" class="md-nav__link">
    Running the plugin
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-plugin" class="md-nav__link">
    Testing your plugin
  </a>
  
    <nav class="md-nav" aria-label="Testing your plugin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#writing-a-serialization-test" class="md-nav__link">
    Writing a serialization test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functional-tests" class="md-nav__link">
    Functional tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#embedding-your-plugin" class="md-nav__link">
    Embedding your plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-can-i-add-a-field-with-dashes-such-as-my-field" class="md-nav__link">
    How can I add a field with dashes, such as my-field?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-write-a-dataclass-from-a-schema-to-a-yaml-or-json-file" class="md-nav__link">
    How can I write a dataclass from a schema to a YAML or JSON file?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-can-i-easily-load-a-list-from-a-yaml-or-json-into-a-list-of-dataclasses" class="md-nav__link">
    How can I easily load a list from a YAML or JSON into a list of dataclasses?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="creating-plugins-with-python">Creating plugins with Python</h1>
<p>If you want to create an Arcaflow plugin in Python, you will need three things:</p>
<ol>
<li>A container engine that can build images</li>
<li>Python 3.9+ (<a href="https://www.pypy.org/">PyPy</a> is supported)</li>
<li>The <a href="https://github.com/arcalot/arcaflow-plugin-sdk-python">Python SDK for Arcaflow plugins</a></li>
</ol>
<p>The easiest way is to start from the <a href="https://github.com/arcalot/arcaflow-plugin-template-python">template repository for Python plugins</a>, but starting from scratch is also fully supported.</p>
<p>Before you start please familiarize yourself with the <a href="../../concepts/typing/">Arcaflow type system</a>.</p>
<h2 id="setting-up-your-environment">Setting up your environment</h2>
<p>First, you will have to set up your environment.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">From the template repository</label><label for="__tabbed_1_2">Using pip</label><label for="__tabbed_1_3">Using Poetry</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>Fork, then clone the <a href="https://github.com/arcalot/arcaflow-plugin-template-python">template repository</a></li>
<li>Figure out what the right command to call your Python version is:
       <div class="highlight"><pre><span></span><code>python3.10 --version
python3.9 --version
python3 --version
python --version
</code></pre></div>
   Make sure you have at least Python 3.9.</li>
<li>Create a <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a> in your project directory using the following command, replacing your Python call:
       <div class="highlight"><pre><span></span><code>python -m venv venv
</code></pre></div></li>
<li>Activate the venv:
       <div class="highlight"><pre><span></span><code>source venv/bin/activate
</code></pre></div></li>
<li>Install the dependencies:
       <div class="highlight"><pre><span></span><code>pip install -r requirements.txt
</code></pre></div></li>
<li>Run the test plugin:
       <div class="highlight"><pre><span></span><code>./example_plugin.py -f example.yaml
</code></pre></div></li>
<li>Run the unit tests:
       <div class="highlight"><pre><span></span><code>./test_example_plugin.py
</code></pre></div></li>
<li>Generate a JSON schema:
       <div class="highlight"><pre><span></span><code>./example_plugin.py --json-schema input &gt;example.schema.json
</code></pre></div>
  If you are using the <a href="https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml">YAML plugin for VSCode</a>, add the following line to the top of your config file for code completion:
       <div class="highlight"><pre><span></span><code># yaml-language-server: $schema=example.schema.json
</code></pre></div></li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>Create an empty folder.</li>
<li>Create a <code>requirements.txt</code> with the following content:
       <div class="highlight"><pre><span></span><code>arcaflow-plugin-sdk
</code></pre></div></li>
<li>Figure out what the right command to call your Python version is:
       <div class="highlight"><pre><span></span><code>python3.10 --version
python3.9 --version
python3 --version
python --version
</code></pre></div>
   Make sure you have at least Python 3.9.</li>
<li>Create a <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a> in your project directory using the following command, replacing your Python call:
       <div class="highlight"><pre><span></span><code>python -m venv venv
</code></pre></div></li>
<li>Activate the venv:
       <div class="highlight"><pre><span></span><code>source venv/bin/activate
</code></pre></div></li>
<li>Install the dependencies:
       <div class="highlight"><pre><span></span><code>pip install -r requirements.txt
</code></pre></div></li>
<li>Copy the <a href="https://github.com/arcalot/arcaflow-plugin-template-python/blob/main/arcaflow_plugin_template_python/example_plugin.py">example plugin</a>, <a href="https://github.com/arcalot/arcaflow-plugin-template-python/blob/main/example.yaml">example config</a> and the [tests]https://github.com/arcalot/arcaflow-plugin-template-python/blob/main/tests/test_example_plugin.py) to your directory.</li>
<li>Run the test plugin:
       <div class="highlight"><pre><span></span><code>./example_plugin.py -f example.yaml
</code></pre></div></li>
<li>Run the unit tests:
       <div class="highlight"><pre><span></span><code>./test_example_plugin.py
</code></pre></div></li>
<li>Generate a JSON schema:
       <div class="highlight"><pre><span></span><code>./example_plugin.py --json-schema input &gt;example.schema.json
</code></pre></div>
  If you are using the <a href="https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml">YAML plugin for VSCode</a>, add the following line to the top of your config file for code completion:
       <div class="highlight"><pre><span></span><code># yaml-language-server: $schema=example.schema.json
</code></pre></div></li>
<li>Copy and customize the <a href="https://github.com/arcalot/arcaflow-plugin-template-python/blob/main/Dockerfile">Dockerfile</a> from the example repository.</li>
<li>Set up your CI/CD system as you see fit.</li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>Assuming you have <a href="https://python-poetry.org">Poetry</a> installed, run the following command:
       <div class="highlight"><pre><span></span><code>poetry new your-plugin
</code></pre></div>
   Then change the current directory to <code>your-plugin</code>.</li>
<li>Figure out what the right command to call your Python version is:
       <div class="highlight"><pre><span></span><code>which python3.10
which python3.9
which python3
which python
</code></pre></div>
   Make sure you have at least Python 3.9.</li>
<li>Set Poetry to Python 3.9:
       <div class="highlight"><pre><span></span><code>poetry env use /path/to/your/python3.9
</code></pre></div></li>
<li>Check that your <code>pyproject.toml</code> file has the following lines:
       <div class="highlight"><pre><span></span><code><span class="k">[tool.poetry.dependencies]</span>
<span class="n">python</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;^3.9&quot;</span>
</code></pre></div></li>
<li>Add the SDK as a dependency:
       <div class="highlight"><pre><span></span><code>poetry add arcaflow-plugin-sdk
</code></pre></div></li>
<li>Copy the <a href="https://github.com/arcalot/arcaflow-plugin-template-python/blob/main/arcaflow_plugin_template_python/example_plugin.py">example plugin</a>, <a href="https://github.com/arcalot/arcaflow-plugin-template-python/blob/main/example.yaml">example config</a> and the [tests]https://github.com/arcalot/arcaflow-plugin-template-python/blob/main/tests/test_example_plugin.py) to your directory.</li>
<li>Activate the venv:
       <div class="highlight"><pre><span></span><code>poetry shell
</code></pre></div></li>
<li>Run the test plugin:
       <div class="highlight"><pre><span></span><code>./example_plugin.py -f example.yaml
</code></pre></div></li>
<li>Run the unit tests:
       <div class="highlight"><pre><span></span><code>./test_example_plugin.py
</code></pre></div></li>
<li>Generate a JSON schema:
       <div class="highlight"><pre><span></span><code>./example_plugin.py --json-schema input &gt;example.schema.json
</code></pre></div>
  If you are using the <a href="https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml">YAML plugin for VSCode</a>, add the following line to the top of your config file for code completion:
       <div class="highlight"><pre><span></span><code># yaml-language-server: $schema=example.schema.json
</code></pre></div></li>
<li>Copy and customize the <a href="https://github.com/arcalot/arcaflow-plugin-template-python/blob/main/Dockerfile">Dockerfile</a> from the example repository.</li>
<li>Set up your CI/CD system as you see fit.</li>
</ol>
</div>
</div>
</div>
<p>Now you are ready to start hacking away at your plugin!</p>
<h2 id="creating-your-plugin-the-easy-way">Creating your plugin the easy way</h2>
<p>A plugin is nothing but a list of functions with type-annotated parameters and decorators. For example, let&rsquo;s create a function:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pod_scenario</span><span class="p">(</span><span class="n">input_parameter</span><span class="p">):</span>
    <span class="c1"># Do pod scenario magic here</span>
</code></pre></div>
<p>However, this SDK uses <a href="https://docs.python.org/3/library/typing.html">Python type hints</a> and <a href="https://peps.python.org/pep-0318/">decorators</a> to automatically generate the schema required for Arcaflow. Alternatively, you can also <a href="#building-a-schema-by-hand">build a schema by hand</a>. The current section describes the automated way, the <a href="#building-a-schema-by-hand">section below</a> describes the manual way.</p>
<h3 id="input-parameters">Input parameters</h3>
<p>Your step function must take exactly one input parameter. This parameter must be a <a href="https://docs.python.org/3/library/dataclasses.html">dataclass</a>. For example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">PodScenarioParams</span><span class="p">:</span>
    <span class="n">namespace_pattern</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;.*&quot;</span><span class="p">)</span>
    <span class="n">pod_name_pattern</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;.*&quot;</span><span class="p">)</span>
</code></pre></div>
<p>As you can see, our dataclass has two fields, each of which is a <code>re.Pattern</code>. This SDK automatically reads the types of the fields to construct the schema. See the <a href="#types">Types</a> section below for supported type patterns.</p>
<h3 id="output-parameters">Output parameters</h3>
<p>Now that you have your input parameter class, you must create one or more output classes in a similar fashion:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Pod</span><span class="p">:</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">PodScenarioResults</span><span class="p">:</span>
    <span class="n">pods_killed</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Pod</span><span class="p">]</span>
</code></pre></div>
<p>As you can see, your input may incorporate other classes, which themselves have to be dataclasses. Read on for <a href="#types">more information on types</a>.</p>
<h3 id="creating-a-step-function">Creating a step function</h3>
<p>Now that we have both our input and output(s), let&rsquo;s go back to our initial <code>pod_scenario</code> function. Here we need to add a decorator to tell the SDK about metadata, and more importantly, what the return types are. (This is needed because Python does not support reading return types to an adequate level.)</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">arcaflow_plugin_sdk</span> <span class="kn">import</span> <span class="n">plugin</span>


<span class="nd">@plugin</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;pod&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Pod scenario&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Kill one or more pods matching the criteria&quot;</span><span class="p">,</span>
    <span class="n">outputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="n">PodScenarioResults</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">PodScenarioError</span><span class="p">},</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">pod_scenario</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">PodScenarioParams</span><span class="p">):</span>
    <span class="c1"># Fail for now</span>
    <span class="k">return</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">PodScenarioError</span><span class="p">(</span><span class="s2">&quot;Not implemented&quot;</span><span class="p">)</span>
</code></pre></div>
<p>As you can see, apart from the metadata, we also declare the type of the parameter object so the SDK can read it.</p>
<p>Let&rsquo;s go through the <code>@plugin.step</code> decorator parameters one by one:</p>
<ul>
<li><code>id</code> indicates the identifier of this step. This must be globally unique</li>
<li><code>name</code> indicates a human-readable name for this step</li>
<li><code>description</code> indicates a longer description for this step</li>
<li><code>outputs</code> indicates which possible outputs the step can have, with their output identifiers as keys</li>
</ul>
<p>The function must return the output identifier, along with the output object.</p>
<h3 id="running-the-plugin">Running the plugin</h3>
<p>Finally, we need to call <code>plugin.run()</code> in order to actually run the plugin:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">build_schema</span><span class="p">(</span>
        <span class="c1"># Pass one or more scenario functions here</span>
        <span class="n">pod_scenario</span><span class="p">,</span>
    <span class="p">)))</span>
</code></pre></div>
<p>You can now call your plugin using <code>./yourscript.py -f path-to-parameters.yaml</code>. If you have defined more than one step, you also need to pass the <code>-s step-id</code> parameter.</p>
<p><strong>Keep in mind, you should always test your plugin.</strong> See <a href="#testing-your-plugin">Testing your plugin</a> below for details.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To prevent output from breaking the functionality when attached to the Arcaflow Engine, the SDK hides any output your step function writes to the standard output or standard error. You can use the <code>--debug</code> flag to show any output on the standard error in standalone mode.</p>
</div>
<h3 id="types">Types</h3>
<p>The SDK supports a wide range of types. Let&rsquo;s start with the basics:</p>
<ul>
<li><code>str</code></li>
<li><code>int</code></li>
<li><code>float</code></li>
<li><code>bool</code></li>
<li>Enums</li>
<li><code>re.Pattern</code></li>
<li><code>typing.List[othertype]</code> (you must specify the type for the contents of the list)</li>
<li><code>typing.Dict[keytype, valuetype]</code> (you must specify the type for the keys and values)</li>
<li>Any dataclass</li>
</ul>
<h4 id="optional-parameters">Optional parameters</h4>
<p>You can also declare any parameter as optional like this:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="n">param</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
<p>Note that adding <code>typing.Optional</code> is not enough, you <em>must</em> specify the default value.</p>
<h4 id="union-types">Union types</h4>
<p>Union types are supported as long as all members are dataclasses. For example:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyParams</span><span class="p">:</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">]]</span>
</code></pre></div>
<p>In the underlying transport a field name <code>_type</code> will be added to act as a serialization discriminator. You can also customize the discriminator field:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyParams</span><span class="p">:</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span>
        <span class="n">typing</span><span class="o">.</span><span class="n">Annotated</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">],</span>
            <span class="n">annotations</span><span class="o">.</span><span class="n">discriminator</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">]</span>
</code></pre></div>
<p>If you intend to use a non-string descriminator field, or you want to manually specify the discriminator value, you can
do so by adding a <code>discriminator_value</code> annotation:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyParams</span><span class="p">:</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span>
        <span class="n">typing</span><span class="o">.</span><span class="n">Annotated</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
                <span class="n">typing</span><span class="o">.</span><span class="n">Annotated</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">annotations</span><span class="o">.</span><span class="n">discriminator_value</span><span class="p">(</span><span class="s2">&quot;first&quot;</span><span class="p">)],</span>
                <span class="n">typing</span><span class="o">.</span><span class="n">Annotated</span><span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">annotations</span><span class="o">.</span><span class="n">discriminator_value</span><span class="p">(</span><span class="s2">&quot;second&quot;</span><span class="p">)]</span>
            <span class="p">],</span>
            <span class="n">annotations</span><span class="o">.</span><span class="n">discriminator</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">]</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can add the discriminator field to your underlying dataclasses, but when present, their schema must match <em>exactly</em>.</p>
</div>
<h4 id="validation">Validation</h4>
<p>You can also validate the values by using <a href="https://docs.python.org/3/library/typing.html#typing.Annotated"><code>typing.Annotated</code></a>, such as this:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="n">param</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">schema</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
</code></pre></div>
<p>This will create a minimum-value validation for the parameter of 5. The following annotations are supported for validation:</p>
<ul>
<li><code>schema.min()</code> for strings, ints, floats, lists, and maps</li>
<li><code>schema.max()</code> for strings, ints, floats, lists, and maps</li>
<li><code>schema.pattern()</code> for strings</li>
<li><code>schema.required_if()</code> for any field on an object</li>
<li><code>schema.required_if_not()</code> for any field on an object</li>
<li><code>schema.conflicts()</code> for any field on an object</li>
</ul>
<h4 id="metadata">Metadata</h4>
<p>You can add metadata to your schema by using annotations</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="n">param</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Annotated</span><span class="p">[</span>
           <span class="nb">str</span><span class="p">,</span>
           <span class="n">schema</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="s2">&quot;my-param&quot;</span><span class="p">),</span>
           <span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s2">&quot;Parameter 1&quot;</span><span class="p">),</span>
           <span class="n">schema</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="s2">&quot;This is a parameter&quot;</span><span class="p">),</span>
           <span class="n">schema</span><span class="o">.</span><span class="n">icon</span><span class="p">(</span><span class="s2">&quot;&lt;svg...&gt;Add a 64x64 SVG here&lt;/svg&gt;&quot;</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div>
<h3 id="default-values">Default values</h3>
<p>You can add default values for your dataclass members like this:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="n">param</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;this is the default value&quot;</span>
</code></pre></div>
<h3 id="units">Units</h3>
<p>You can also include unit information in your schema. This will allow a user interface to treat your values accordingly:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="n">param</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Annotated</span><span class="p">[</span>
        <span class="nb">int</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">units</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">UNIT_BYTE</span><span class="p">),</span>
    <span class="p">]</span>
</code></pre></div>
<p>You can also define your own unit. For that, you have to define your base unit (e.g. &ldquo;bytes&rdquo;) and then the multipliers:</p>
<div class="highlight"><pre><span></span><code><span class="n">UNIT_BYTE</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span>
        <span class="c1"># Short, singular form:</span>
        <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="c1"># Short, plural form:</span>
        <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="c1"># Long, singular form:</span>
        <span class="s2">&quot;byte&quot;</span><span class="p">,</span>
        <span class="c1"># Long, plural form:</span>
        <span class="s2">&quot;bytes&quot;</span>
    <span class="p">),</span>
    <span class="p">{</span>
        <span class="mi">1024</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span>
            <span class="s2">&quot;kB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;kB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;kilobyte&quot;</span><span class="p">,</span>
            <span class="s2">&quot;kilobytes&quot;</span>
        <span class="p">),</span>
        <span class="mi">1048576</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span>
            <span class="s2">&quot;MB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;megabyte&quot;</span><span class="p">,</span>
            <span class="s2">&quot;megabytes&quot;</span>
        <span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>This also allows you to parse strings like <code>5MB 4kB</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">parsed_unit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">UNIT_BYTE</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;5MB 4 kB&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Conversely, you can also render the units:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">UNIT_BYTE</span><span class="o">.</span><span class="n">format_short</span><span class="p">(</span><span class="mi">5246976</span><span class="p">))</span>
</code></pre></div>
<p>Check the code completion for your units for more options.</p>
<h3 id="examples">Examples</h3>
<p>You can also provide example values for your fields to help people providing the data:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="n">param</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Annotated</span><span class="p">[</span>
        <span class="nb">int</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">example</span><span class="p">(</span><span class="mi">1024</span><span class="p">),</span>
    <span class="p">]</span>
</code></pre></div>
<p>You can, of course, provide multiple examples too. Note, the example must be provided in its raw form (as dicts,
lists, and scalars), not as dataclasses!</p>
<h2 id="creating-your-plugin-the-hard-way-not-recommended">Creating your plugin the hard way (not recommended)</h2>
<p>For performance reasons, or for the purposes of separation of concerns, you may want to create a schema by hand. This section walks you through declaring a schema by hand and then using it to call a function. Keep in mind, the SDK still primarily operates with dataclasses to transport structured data.</p>
<p>However, we do not recommend this approach because it results in a lot of boilerplate code, and the real-world benefits are marginal at best. Also keep in mind, that your plugin will need more frequent updates if Arcaflow is extending the schema system and you want to switch to new versions.</p>
<p>We start by defining a schema:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">arcaflow_plugin_sdk</span> <span class="kn">import</span> <span class="n">schema</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="n">steps</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="o">.</span><span class="n">StepSchema</span><span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span>
    <span class="n">steps</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>The <code>steps</code> parameter here must be a dict, where the key is the step ID and the value is the step schema. So, let&rsquo;s create a step schema:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">arcaflow_plugin_sdk</span> <span class="kn">import</span> <span class="n">schema</span>

<span class="n">step_schema</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">StepSchema</span><span class="p">(</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;pod&quot;</span><span class="p">,</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Pod scenario&quot;</span><span class="p">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Kills pods&quot;</span><span class="p">,</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">input_schema</span><span class="p">,</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">,</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">my_handler_func</span>
<span class="p">)</span>
</code></pre></div>
<p>Let&rsquo;s go in order:</p>
<ul>
<li>The <code>input</code> must be a schema of the type <code>schema.ObjectType</code>. This describes the single parameter that will be passed to <code>my_handler_func</code>.</li>
<li>The <code>outputs</code> describe a <code>Dict[str, schema.ObjectType]</code>, where the key is the ID for the returned output type, while the value describes the output schema.</li>
<li>The <code>handler</code> function takes one parameter, the object described in <code>input</code> and must return a tuple of a string and the output object. Here the ID uniquely identifies which output is intended, for example <code>success</code> and <code>error</code>, while  the second parameter in the tuple must match the <code>outputs</code> declaration.</li>
</ul>
<p>That&rsquo;s it! Now all that&rsquo;s left is to define the <code>ObjectType</code> and any subobjects.</p>
<h3 id="objecttype">ObjectType</h3>
<p>The ObjectType is intended as a backing type for <a href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a>. For example:</p>
<div class="highlight"><pre><span></span><code><span class="n">t</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">(</span>
    <span class="n">TestClass</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">schema</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">schema</span><span class="o">.</span><span class="n">IntType</span><span class="p">(),</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>The fields support the following parameters:</p>
<ul>
<li><code>type</code>: underlying type schema for the field (required)</li>
<li><code>name</code>: name for the current field</li>
<li><code>description</code>: description for the current field</li>
<li><code>required</code>: marks the field as required</li>
<li><code>required_if</code>: a list of other fields that, if filled, will also cause the current field to be required</li>
<li><code>required_if_not</code>: a list of other fields that, if not set, will cause the current field to be required</li>
<li><code>conflicts</code>: a list of other fields that cannot be set together with the current field</li>
</ul>
<h3 id="scopetype-and-reftype">ScopeType and RefType</h3>
<p>Sometimes it is necessary to create circular references. This is where the <code>ScopeType</code> and the <code>RefType</code> comes into play. Scopes contain a list of objects that can be referenced by their ID, but one object is special: the root object of the scope. The RefType, on the other hand, is there to reference objects in a scope.</p>
<p>Currently, the Python implementation passes the scope to the ref type directly, but the important rule is that ref types <strong>always</strong> reference their nearest scope up the tree. Do not create references that aim at scopes not directly above the ref!</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">OneOfData1</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">OneOfData2</span><span class="p">:</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">OneOfData1</span>

<span class="n">scope</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">ScopeType</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;OneOfData1&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">(</span>
            <span class="n">OneOfData1</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
                    <span class="n">schema</span><span class="o">.</span><span class="n">StringType</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="c1"># Root object of scopes</span>
    <span class="s2">&quot;OneOfData2&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">scope</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;OneOfData2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">(</span>
    <span class="n">OneOfData2</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">RefType</span><span class="p">(</span><span class="s2">&quot;OneOfData1&quot;</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<p>As you can see, this API is not easy to use and is likely to change in the future.</p>
<h3 id="oneoftype">OneOfType</h3>
<p>The OneOfType allows you to create a type that is a combination of other ObjectTypes. When a value is deserialized, a special discriminator field is consulted to figure out which type is actually being sent.</p>
<p>This discriminator field may be present in the underlying type. If it is, the type must match the declaration in the AnyOfType.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">OneOfData1</span><span class="p">:</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">OneOfData2</span><span class="p">:</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">scope</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">ScopeType</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;OneOfData1&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">(</span>
            <span class="n">OneOfData1</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="c1"># Here the discriminator field is also present in the underlying type</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
                    <span class="n">schema</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span>
                <span class="p">),</span>
                <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
                    <span class="n">schema</span><span class="o">.</span><span class="n">StringType</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">),</span>
        <span class="s2">&quot;OneOfData2&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">(</span>
            <span class="n">OneOfData2</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span>
                    <span class="n">schema</span><span class="o">.</span><span class="n">IntType</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">},</span>
    <span class="c1"># Root object of scopes</span>
    <span class="s2">&quot;OneOfData1&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">OneOfStringType</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="c1"># Option 1</span>
        <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">RefType</span><span class="p">(</span>
            <span class="c1"># The RefType resolves against the scope.</span>
            <span class="s2">&quot;OneOfData1&quot;</span><span class="p">,</span>
            <span class="n">scope</span>
        <span class="p">),</span>
        <span class="c1"># Option 2</span>
        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="o">.</span><span class="n">RefType</span><span class="p">(</span>
            <span class="s2">&quot;OneOfData2&quot;</span><span class="p">,</span>
            <span class="n">scope</span>
        <span class="p">),</span>
    <span class="p">},</span>
    <span class="c1"># Pass the scope this type belongs do</span>
    <span class="n">scope</span><span class="p">,</span>
    <span class="c1"># Discriminator field</span>
    <span class="s2">&quot;type&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">serialized_data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">OneOfData1</span><span class="p">(</span>
    <span class="s2">&quot;a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hello world!&quot;</span>
<span class="p">))</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">serialized_data</span><span class="p">)</span>
</code></pre></div>
<p>Note, that the OneOfTypes take all object-like elements, such as refs, objects, or scopes.</p>
<h3 id="stringtype">StringType</h3>
<p>String types indicate that the underlying type is a string. </p>
<div class="highlight"><pre><span></span><code><span class="n">t</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">StringType</span><span class="p">()</span>
</code></pre></div>
<p>The string type supports the following parameters:</p>
<ul>
<li><code>min_length</code>: minimum length for the string (inclusive)</li>
<li><code>max_length</code>: maximum length for the string (inclusive)</li>
<li><code>pattern</code>: regular expression the string must match</li>
</ul>
<h3 id="patterntype">PatternType</h3>
<p>The pattern type indicates that the field must contain a regular expression. It will be decoded as <code>re.Pattern</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">t</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">PatternType</span><span class="p">()</span>
</code></pre></div>
<p>The pattern type has no parameters.</p>
<h3 id="inttype">IntType</h3>
<p>The int type indicates that the underlying type is an integer.</p>
<div class="highlight"><pre><span></span><code><span class="n">t</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">IntType</span><span class="p">()</span>
</code></pre></div>
<p>The int type supports the following parameters:</p>
<ul>
<li><code>min</code>: minimum value for the number (inclusive).</li>
<li><code>max</code>: minimum value for the number (inclusive).</li>
</ul>
<h3 id="floattype">FloatType</h3>
<p>The float type indicates that the underlying type is a floating point number.</p>
<div class="highlight"><pre><span></span><code><span class="n">t</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">FloatType</span><span class="p">()</span>
</code></pre></div>
<p>The float type supports the following parameters:</p>
<ul>
<li><code>min</code>: minimum value for the number (inclusive).</li>
<li><code>max</code>: minimum value for the number (inclusive).</li>
</ul>
<h3 id="booltype">BoolType</h3>
<p>The bool type indicates that the underlying value is a boolean. When unserializing, this type also supports string and integer values of <code>true</code>, <code>yes</code>, <code>on</code>, <code>enable</code>, <code>enabled</code>, <code>1</code>, <code>false</code>, <code>no</code>, <code>off</code>, <code>disable</code>, <code>disabled</code> or <code>0</code>.</p>
<h3 id="enumtype">EnumType</h3>
<p>The enum type creates a type from an existing enum:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MyEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
    <span class="n">B</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">EnumType</span><span class="p">(</span><span class="n">MyEnum</span><span class="p">)</span>
</code></pre></div>
<p>The enum type has no further parameters.</p>
<h3 id="listtype">ListType</h3>
<p>The list type describes a list of items. The item type must be described:</p>
<div class="highlight"><pre><span></span><code><span class="n">t</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">ListType</span><span class="p">(</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">StringType</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<p>The list type supports the following extra parameters:</p>
<ul>
<li><code>min</code>: The minimum number of items in the list (inclusive)</li>
<li><code>max</code>: The maximum number of items in the list (inclusive)</li>
</ul>
<h3 id="maptype">MapType</h3>
<p>The map type describes a key-value type (dict). You must specify both the key and the value type:</p>
<div class="highlight"><pre><span></span><code><span class="n">t</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">MapType</span><span class="p">(</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">StringType</span><span class="p">(),</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">StringType</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<p>The map type supports the following extra parameters:</p>
<ul>
<li><code>min</code>: The minimum number of items in the map (inclusive)</li>
<li><code>max</code>: The maximum number of items in the map (inclusive)</li>
</ul>
<h3 id="running-the-plugin_1">Running the plugin</h3>
<p>If you create the schema by hand, you can add the following code to your plugin: </p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">your_schema</span><span class="p">))</span>
</code></pre></div>
<p>You can then run your plugin as described before.</p>
<h2 id="testing-your-plugin">Testing your plugin</h2>
<p>You should always make sure you have enough test coverage to prevent your plugin from breaking. To help you with testing, this SDK provides some tools for testing:</p>
<ol>
<li>Serialization tests for your input and output to make sure your classes can be serialized for transport</li>
<li>Functional tests that call your plugin and make sure it works correctly</li>
</ol>
<h3 id="writing-a-serialization-test">Writing a serialization test</h3>
<p>You can use any test framework you like for your serialization test, we&rsquo;ll demonstrate with <a href="https://docs.python.org/3/library/unittest.html">unittest</a> as it is included directly in Python. The key to this test is to call <code>plugin.test_object_serialization()</code> with an instance of your dataclass that you want to test:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ExamplePluginTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_serialization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">test_object_serialization</span><span class="p">(</span>
            <span class="n">example_plugin</span><span class="o">.</span><span class="n">PodScenarioResults</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">example_plugin</span><span class="o">.</span><span class="n">Pod</span><span class="p">(</span>
                        <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;nginx-asdf&quot;</span>
                    <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">))</span>
</code></pre></div>
<p>Remember, you need to call this function with an <strong>instance</strong> containing actual data, not just the class name.</p>
<p>The test function will first serialize, then unserialize your data and check if it&rsquo;s the same. If you want to use a manually created schema, you can do so, too:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ExamplePluginTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_serialization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">test_object_serialization</span><span class="p">(</span>
            <span class="n">example_plugin</span><span class="o">.</span><span class="n">PodScenarioResults</span><span class="p">(</span>
                <span class="c1">#...</span>
            <span class="p">),</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">(</span>
                <span class="c1">#...</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>
<h3 id="functional-tests">Functional tests</h3>
<p>Functional tests don&rsquo;t have anything special about them. You can directly call your code with your dataclasses as parameters, and check the return. This works best on auto-generated schemas with the <code>@plugin.step</code> decorator. See below for manually created schemas.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ExamplePluginTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_functional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="n">example_plugin</span><span class="o">.</span><span class="n">PodScenarioParams</span><span class="p">()</span>

        <span class="n">output_id</span><span class="p">,</span> <span class="n">output_data</span> <span class="o">=</span> <span class="n">example_plugin</span><span class="o">.</span><span class="n">pod_scenario</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

        <span class="c1"># Check if the output is always an error, as it is the case for the example plugin.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">output_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">output_data</span><span class="p">,</span>
            <span class="n">example_plugin</span><span class="o">.</span><span class="n">PodScenarioError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot kill pod .* in namespace .*, function not implemented&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>
<p>If you created your schema manually, the best way to write your tests is to include the schema in your test. This will automatically validate both the input and the output, making sure they conform to your schema. For example:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ExamplePluginTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_functional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">step_schema</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">StepSchema</span><span class="p">(</span>
            <span class="c1">#...</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">example_plugin</span><span class="o">.</span><span class="n">pod_scenario</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="n">example_plugin</span><span class="o">.</span><span class="n">PodScenarioParams</span><span class="p">()</span>

        <span class="n">output_id</span><span class="p">,</span> <span class="n">output_data</span> <span class="o">=</span> <span class="n">step_schema</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

        <span class="c1"># Check if the output is always an error, as it is the case for the example plugin.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">output_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">output_data</span><span class="p">,</span>
            <span class="n">example_plugin</span><span class="o">.</span><span class="n">PodScenarioError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot kill pod .* in namespace .*, function not implemented&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>
<h2 id="embedding-your-plugin">Embedding your plugin</h2>
<p>Instead of using your plugin as a standalone tool or in conjunction with Arcaflow, you can also embed your plugin into your existing Python application. To do that you simply build a schema using one of the methods described above and then call the schema yourself. You can pass raw data as an input, and you&rsquo;ll get the benefit of schema validation.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Build your schema using the schema builder from above with the step functions passed.</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">build_schema</span><span class="p">(</span><span class="n">pod_scenario</span><span class="p">)</span>

<span class="c1"># Which step we want to execute</span>
<span class="n">step_id</span> <span class="o">=</span> <span class="s2">&quot;pod&quot;</span>
<span class="c1"># Input parameters. Note, these must be a dict, not a dataclass</span>
<span class="n">step_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;pod_name_pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;.*&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pod_namespace_pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;.*&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Execute the step</span>
<span class="n">output_id</span><span class="p">,</span> <span class="n">output_data</span> <span class="o">=</span> <span class="n">schema</span><span class="p">(</span><span class="n">step_id</span><span class="p">,</span> <span class="n">step_params</span><span class="p">)</span>

<span class="c1"># Print which kind of result we have</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">output_id</span><span class="p">)</span>
<span class="c1"># Print the result data</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
</code></pre></div>
<p>However, the example above requires you to provide the data as a <code>dict</code>, not a <code>dataclass</code>, and it will also return a <code>dict</code> as an output object. Sometimes, you may want to use a partial approach, where you only use part of the SDK. In this case, you can change your code to run any of the following functions, in order:</p>
<ul>
<li><code>serialization.load_from_file()</code> to load a YAML or JSON file into a dict</li>
<li><code>yourschema.unserialize_input()</code> to turn a <code>dict</code> into a <code>dataclass</code> needed for your steps</li>
<li><code>yourschema.call_step()</code> to run a step with the unserialized <code>dataclass</code></li>
<li><code>yourschema.serialize_output()</code> to turn the output <code>dataclass</code> into a <code>dict</code></li>
</ul>
<h2 id="faq">FAQ</h2>
<h3 id="how-can-i-add-a-field-with-dashes-such-as-my-field">How can I add a field with dashes, such as <code>my-field</code>?</h3>
<p>Dataclasses don&rsquo;t support dashes in parameters. You can work around this by defining the <code>id</code> annotation:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MyData</span><span class="p">:</span>
    <span class="n">my_field</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Annotated</span><span class="p">[</span>
        <span class="nb">str</span><span class="p">,</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">id</span><span class="p">(</span><span class="s2">&quot;my-field&quot;</span><span class="p">),</span>
    <span class="p">]</span>
</code></pre></div>
<h3 id="how-can-i-write-a-dataclass-from-a-schema-to-a-yaml-or-json-file">How can I write a dataclass from a schema to a YAML or JSON file?</h3>
<p>You can <a href="https://stackoverflow.com/questions/51286748/make-the-python-json-encoder-support-pythons-new-dataclasses">extend Pythons JSON encoder</a> to support dataclasses. If that doesn&rsquo;t suit your needs, you can use this SDK to convert the dataclasses to their basic representations and then write that to your JSON or YAML file. First, add this outside of your step:</p>
<div class="highlight"><pre><span></span><code><span class="n">my_object_schema</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">build_object_schema</span><span class="p">(</span><span class="n">YourDataclass</span><span class="p">)</span>
</code></pre></div>
<p>Inside your step function you can then dump the data from your input</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">your_step</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">YourParams</span><span class="p">)</span>
    <span class="n">yaml_contents</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">my_object_schema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">some_param</span><span class="p">))</span>
</code></pre></div>
<h3 id="how-can-i-easily-load-a-list-from-a-yaml-or-json-into-a-list-of-dataclasses">How can I easily load a list from a YAML or JSON into a list of dataclasses?</h3>
<p>This requires a bit of trickery. First, we build a schema from the dataclass representing the row or entry in the list:</p>
<div class="highlight"><pre><span></span><code><span class="n">my_row_schema</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">build_object_schema</span><span class="p">(</span><span class="n">MyRow</span><span class="p">)</span>
</code></pre></div>
<p>Then you can create a list schema:</p>
<div class="highlight"><pre><span></span><code><span class="n">my_list_schema</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">ListType</span><span class="p">(</span><span class="n">my_row_schema</span><span class="p">)</span>
</code></pre></div>
<p>You can now unserialize a list obtained from the YAML or JSON file:</p>
<div class="highlight"><pre><span></span><code><span class="n">my_data</span> <span class="o">=</span> <span class="n">my_list_schema</span><span class="o">.</span><span class="n">unserialize</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/arcalot" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "search.suggest", "search.highlight", "search.share"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.ce72ebac.min.js"></script>
      
    
  </body>
</html>